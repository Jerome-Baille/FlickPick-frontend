<main class="archive-main">
  <!-- Header Section -->
  <div class="archive-header">
    <div class="header-content">
      <app-header-badge text="Hall of Fame" icon="emoji_events"></app-header-badge>
      <h1 class="archive-title">The Archive</h1>
      <p class="archive-subtitle">
        A curated collection of our movie night champions. Relive the winners of
        the past.
      </p>
    </div>
    <div class="header-search">
      <div class="search-wrapper">
        <span class="material-symbols-outlined search-icon">search</span>
        <input
          id="archive-search"
          name="search"
          type="text"
          class="search-input"
          placeholder="Search archive..."
          (input)="onSearchChange($any($event.target).value)"
          [value]="search()"
        />
      </div>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filter-chips">
      <label class="filter-chip group">
        <div class="chip-inner">
          <p class="chip-label-text">Year: {{ selectedYear() || "All" }}</p>
          <span class="material-symbols-outlined chip-icon"
            >keyboard_arrow_down</span
          >
        </div>
        <select
          id="filter-year"
          name="year"
          class="filter-select"
          aria-label="Filter by year"
          (change)="onYearChange($any($event.target).value)"
        >
          <option value="All">All</option>
          @for (y of years(); track y) {
          <option [value]="y">{{ y }}</option>
          }
        </select>
      </label>
      <!-- Genre filter removed -->
      <label class="filter-chip group">
        <div class="chip-inner">
          <p class="chip-label-text">
            Rating: {{ selectedRating() > 0 ? selectedRating() + "+" : "All" }}
          </p>
          <span class="material-symbols-outlined chip-icon"
            >keyboard_arrow_down</span
          >
        </div>
        <select
          id="filter-rating"
          name="rating"
          class="filter-select"
          aria-label="Filter by rating"
          (change)="onRatingChange($any($event.target).value)"
        >
          <option value="0">All</option>
          <option value="5">5+</option>
          <option value="4">4+</option>
          <option value="3">3+</option>
          <option value="2">2+</option>
        </select>
      </label>
    </div>
    <app-view-toggle
      [viewMode]="viewMode()"
      (viewModeChange)="setViewMode($event)"
    ></app-view-toggle>
  </div>

  <!-- Grid Section -->
  <div class="archive-grid" [class.list-view]="viewMode() === 'list'">
    @if (!loading() && filteredWinners().length === 0) {
    <div class="empty-state">
      <div class="empty-icon">
        <span class="material-symbols-outlined">movie</span>
      </div>
      <p class="empty-title">The archives are dusty...</p>
      <p class="empty-desc">
        No past winners found. Finished events will appear here when a winner is
        chosen.
      </p>
    </div>
    } @if (filteredWinners().length > 0) { @for (item of filteredWinners();
    track item.eventId) {
    <div class="movie-card">
      <a
        [routerLink]="['/media/detail/movie', item.media?.tmdbId]"
        class="poster-container"
        [attr.title]="item.media?.title"
      >
        <div
          class="poster-image"
          [style.background-image]="
            'url(' +
            (item.media?.posterPath || '/assets/placeholder-300x450.png') +
            ')'
          "
        ></div>
        <div class="poster-gradient"></div>
        <div class="rating-badge">
          <span class="material-symbols-outlined star-icon">star</span>
          <span>{{ item.media?.rating | number : "1.1-1" }}</span>
        </div>
        <div class="poster-meta">
          <p class="meta-genre">{{ item.media?.genre || "Movie" }}</p>
          <p class="meta-title">{{ item.media?.title }}</p>
        </div>
      </a>
      <a
        [routerLink]="['/event/detail', item.eventId]"
        class="card-footer card-footer-grid"
        [attr.aria-label]="'Event ' + item.eventName"
      >
        <div class="date-info">
          <span class="material-symbols-outlined date-icon"
            >calendar_today</span
          >
          <span class="date-text">{{ formatDate(item.eventDate) }}</span>
        </div>
      </a>
      <div class="list-content">
        <a
          [routerLink]="['/media/detail/movie', item.media?.tmdbId]"
          class="list-meta"
          [attr.title]="item.media?.title"
          [attr.aria-label]="'Media ' + item.media?.title"
        >
          <p class="list-meta-title">{{ item.media?.title }}</p>
          <p class="list-meta-type">{{ item.media?.mediaType | titlecase }}</p>
        </a>

        <a
          [routerLink]="['/event/detail', item.eventId]"
          class="card-footer"
          [attr.aria-label]="'Event ' + item.eventName"
        >
          <div class="date-info">
            <span class="material-symbols-outlined date-icon"
              >calendar_today</span
            >
            <span class="date-text">{{ formatDate(item.eventDate) }}</span>
          </div>
        </a>
      </div>
    </div>
    } }
  </div>

  @if (loading()) {
  <div class="loading-container">
    <span class="material-symbols-outlined loading-spinner"
      >progress_activity</span
    >
  </div>
  }
</main>
