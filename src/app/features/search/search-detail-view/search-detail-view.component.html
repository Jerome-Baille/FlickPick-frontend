<main class="detail-container">
    @if (media) {
        <!-- Breadcrumb Navigation -->
        <nav class="breadcrumb">
            <app-back-button />
        </nav>

        <!-- Main Glass Panel -->
        <div class="glass-panel">
            <!-- Background Blur Image -->
            <div class="background-blur" 
                [style.background-image]="'url(' + (media.poster_path ? TMDB_IMAGE_BASE_URL + media.poster_path : 'assets/images/poster-not-found.png') + ')'">
            </div>
            
            <!-- Gradient Overlay -->
            <div class="gradient-overlay"></div>

            <!-- Content Wrapper -->
            <div class="content-wrapper">
                <!-- Poster Section -->
                <div class="poster-section">
                    <div class="poster-wrapper" role="button" tabindex="0" (click)="findTrailer()" (keydown.enter)="findTrailer()">
                        <img [src]="media.poster_path ? TMDB_IMAGE_BASE_URL + media.poster_path : 'assets/images/poster-not-found.png'"
                            alt="{{ media.title || media.name }}" />
                        @if (media.videos?.results && media.videos?.results?.length !== 0) {
                            <div class="play-overlay">
                                <button class="play-button" type="button">
                                    <mat-icon>play_arrow</mat-icon>
                                </button>
                            </div>
                        }
                    </div>
                    <div class="poster-shadow"></div>
                </div>

                <!-- Details Section -->
                <div class="details-section">
                    <!-- Title Section -->
                    <div class="title-section">
                        <h1>
                            <span class="title-gradient">{{ media.title || media.name }}</span>
                        </h1>
                        @if (media.tagline) {
                            <p class="tagline">"{{ media.tagline }}"</p>
                        }
                    </div>

                    <!-- Metadata Row -->
                    <div class="metadata-row">
                        @if (media.release_date || media.first_air_date) {
                            <span class="year-badge">{{ getYear(media.release_date || media.first_air_date) }}</span>
                            <span class="dot-separator"></span>
                        }
                        @if (media.genres && media.genres.length > 0) {
                            <span>
                                @for (genre of media.genres; track genre.id; let last = $last; let i = $index) {
                                    @if (i < 2) {
                                        {{ genre.name }}{{ !last && i < 1 ? ' / ' : '' }}
                                    }
                                }
                            </span>
                            <span class="dot-separator"></span>
                        }
                        @if (media.runtime || media.episode_run_time) {
                            <span class="runtime">
                                <mat-icon>schedule</mat-icon>
                                {{ getDuration(media.runtime || media.episode_run_time) }}
                            </span>
                            <span class="dot-separator"></span>
                        }
                        @if (media.number_of_seasons) {
                            <span>{{ media.number_of_seasons }} Season{{ media.number_of_seasons > 1 ? 's' : '' }}</span>
                            <span class="dot-separator"></span>
                        }
                        @if (media.vote_average) {
                            <div class="rating-stars">
                                @for (star of getStars(media.vote_average); track $index) {
                                    <mat-icon>{{ star }}</mat-icon>
                                }
                                <span class="rating-value">{{ (media.vote_average / 2).toFixed(1) }}</span>
                            </div>
                        }
                    </div>

                    <!-- Synopsis Section -->
                    @if (media.overview) {
                        <div class="synopsis-section">
                            <h3>Synopsis</h3>
                            <p>{{ media.overview }}</p>
                        </div>
                    }

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        @if (media.videos?.results && media.videos?.results?.length !== 0) {
                            <button class="btn-primary" (click)="findTrailer()">
                                <mat-icon>play_circle</mat-icon>
                                Watch Trailer
                            </button>
                        }
                        <button class="btn-secondary" (click)="goToExternalLink()">
                            <mat-icon>open_in_new</mat-icon>
                            View on TMDB
                        </button>
                        <button class="btn-icon" aria-label="Add to favorites">
                            <mat-icon>favorite</mat-icon>
                        </button>
                    </div>

                    <!-- Cast Section -->
                    @if (castArray && castArray.length > 0) {
                        <div class="cast-section">
                            <h3>Top Cast</h3>
                            <ul class="cast-list">
                                @for (cast of castArray; track cast.id) {
                                    <li class="cast-card">
                                        <img [src]="cast.profile_path ? TMDB_IMAGE_BASE_URL + cast.profile_path : 'assets/images/poster-not-found.png'"
                                            alt="{{ cast.name }}" />
                                        <div class="cast-info">
                                            <span class="cast-name">{{ cast.name }}</span>
                                            <span class="cast-character">{{ cast.character }}</span>
                                        </div>
                                    </li>
                                }
                                <li class="show-more-card">
                                    <button class="show-more-button" (click)="onNavigateToCast()">
                                        <span>Show more</span>
                                        <mat-icon>arrow_forward</mat-icon>
                                    </button>
                                </li>
                            </ul>
                        </div>
                    }
                </div>
            </div>
        </div>
    }
</main>