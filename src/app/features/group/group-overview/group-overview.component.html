<main>
    <!-- Page Header -->
    <div class="page-header">
        <div class="header-text">
            <div class="header-label">
                <span class="material-symbols-outlined">groups</span>
                <span>Group Management</span>
            </div>
            <h2 class="page-title">Your Squads</h2>
            <p class="page-description">
                Manage your movie circles, invite friends, and check voting status for your upcoming nights.
            </p>
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" (click)="joinGroup()">
                <span class="material-symbols-outlined">group_add</span>
                <span>Join with Code</span>
            </button>
            <button class="btn btn-secondary" routerLink="/event/create">
                <span class="material-symbols-outlined">movie</span>
                <span>Plan Movie Night</span>
            </button>
            <button class="btn btn-primary" (click)="createGroup()">
                <span class="material-symbols-outlined">add_circle</span>
                <span>Create New Group</span>
            </button>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab active">
                All Groups <span class="tab-count">({{ groups.length }})</span>
            </button>
            <button class="tab">Active Votes</button>
            <button class="tab">Scheduled</button>
            <button class="tab">Archived</button>
        </div>
        <app-view-toggle
            [viewMode]="viewMode"
            (viewModeChange)="setViewMode($event)"
        ></app-view-toggle>
    </div>

    <!-- Groups Grid -->
    <div class="groups-grid" [class.list-mode]="viewMode === 'list'">
        <!-- Create New Group Card -->
        <div class="group-card create-card" 
             (click)="createGroup()"
             (keydown.enter)="createGroup()"
             (keydown.space)="createGroup()"
             tabindex="0"
             role="button">
            <div class="create-icon">
                <span class="material-symbols-outlined">add</span>
            </div>
            <h4 class="create-title">Start a New Club</h4>
            <p class="create-description">
                "I think this is the beginning of a beautiful friendship."
            </p>
        </div>

        <!-- Group Cards -->
        @for (group of groups; track group.id) {
            <div class="group-card">
                <!-- Status Badge -->
                @if (group.isAdmin) {
                    <div class="status-badge badge-admin">
                        <span class="material-symbols-outlined">admin_panel_settings</span>
                        ADMIN
                    </div>
                }

                <!-- Card Image -->
                <div class="card-image" [style.background-image]="'url(' + getGroupImage(group) + ')'">
                    <div class="image-overlay"></div>
                    @if (group.isAdmin) {
                        <div class="card-creator">
                            <span>Created by You</span>
                        </div>
                    }
                </div>

                <!-- Card Content -->
                <div class="card-content">
                    <div class="card-header">
                        <h4 class="card-title" routerLink="/group/detail/{{ group.id }}">{{ group.name }}</h4>
                        <p class="card-subtitle" 
                           (click)="copyGroupCode($event, group.code)" 
                           (keydown.enter)="copyGroupCode($event, group.code)"
                           (keydown.space)="copyGroupCode($event, group.code)"
                           tabindex="0"
                           role="button"
                           title="Click to copy code">
                            Code: {{ group.code }}
                        </p>
                    </div>

                    <div class="card-meta">
                        <div class="meta-item">
                            <span class="material-symbols-outlined">calendar_clock</span>
                            <span>{{ getNextEventDate(group) || 'Next Session TBA' }}</span>
                        </div> 
                        <div class="meta-item">
                            <span class="material-symbols-outlined">people</span>
                            <span>{{ group.Users.length || 1 }} members</span>
                        </div>
                    </div>

                    <!-- Card Footer -->
                    <div class="card-footer">
                        <div class="member-avatars">
                            @for (member of getMockMembers(group); track member; let i = $index) {
                                <div class="avatar" [style.z-index]="10 - i">
                                    <img [src]="member" alt="Member avatar">
                                </div>
                            }
                            @if ((group.Users.length || 1) > 3) {
                                <div class="avatar avatar-count">
                                    +{{ (group.Users.length || 1) - 3 }}
                                </div>
                            }
                        </div>
                        <button class="btn btn-action" routerLink="/group/detail/{{ group.id }}">
                            {{ group.isAdmin ? 'Manage' : 'View Details' }}
                        </button>
                    </div>
                </div>
            </div>
        }

        <!-- Empty State (shown when no groups) -->
        @if (!groups.length) {
            <div class="empty-state-card">
                <div class="empty-icon">
                    <span class="material-symbols-outlined">groups</span>
                </div>
                <h4>No groups yet</h4>
                <p>Create one to start watching together!</p>
            </div>
        }
    </div>
</main>
