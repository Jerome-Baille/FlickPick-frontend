<main>
    <mat-card class="group-detail-card">
        @if (groupData.name) {
            <!-- Header Section -->
            <div class="group-header">
                <div class="header-content">
                    @if (!isEditing) {
                        <div class="title-section">
                            <h1 class="group-title">
                                <fa-icon [icon]="faUsers"></fa-icon>
                                {{ groupData.name }}
                            </h1>
                            @if (groupData.isAdmin) {
                                <button mat-icon-button (click)="enterEditMode()" matTooltip="Edit Group Name">
                                    <mat-icon>edit</mat-icon>
                                </button>
                            }
                        </div>
                    } @else {
                        <div class="title-editing">
                            <mat-form-field appearance="outline">
                                <input matInput type="text" [(ngModel)]="editedGroupName" 
                                    [ngModelOptions]="{ standalone: true }" />
                            </mat-form-field>
                            <button mat-icon-button color="primary" (click)="updateGroupName(editedGroupName)">
                                <mat-icon>done</mat-icon>
                            </button>
                            <button mat-icon-button (click)="isEditing = false">
                                <mat-icon>clear</mat-icon>
                            </button>
                        </div>
                    }
                    <p class="group-subtitle">{{ groupMembers.length }} member{{ groupMembers.length !== 1 ? 's' : '' }} â€¢ {{ groupEvents.length }} movie night{{ groupEvents.length !== 1 ? 's' : '' }}</p>
                </div>

                <!-- Join Code Card -->
                <div class="join-code-card">
                    <p class="join-code-label">Join Code</p>
                    <h2 class="join-code">{{ groupData.code }}</h2>
                    <div class="join-code-actions">
                        <button mat-icon-button (click)="copyLink()" matTooltip="Copy invite link">
                            <mat-icon>content_copy</mat-icon>
                        </button>
                        <button mat-icon-button (click)="showQRCode()" matTooltip="Show QR code">
                            <mat-icon>qr_code_2</mat-icon>
                        </button>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Participants Section -->
            <div class="participants-section">
                <div class="section-header">
                    <h2>
                        <mat-icon>people</mat-icon>
                        Members
                    </h2>
                    @if (groupData.isAdmin) {
                        <button mat-button (click)="manageInvites()">
                            <mat-icon>person_add</mat-icon>
                            Invite Members
                        </button>
                    }
                </div>

                <div class="members-grid">
                    @for (member of groupMembers; track member.id) {
                        <div class="member-card">
                            <div class="member-avatar" [style.background-image]="'url(' + getMemberAvatar(member) + ')'"></div>
                            <div class="member-info">
                                <p class="member-name">{{ member.username }}</p>
                                @if (groupData.adminIds.includes(member.id)) {
                                    <span class="member-role admin">Admin</span>
                                } @else {
                                    <span class="member-role">Member</span>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>

            <div class="divider"></div>

            <!-- Movie Nights Section -->
            <div class="events-section">
                <div class="section-header">
                    <h2>
                        <mat-icon>event</mat-icon>
                        Movie Nights
                    </h2>
                    @if (groupData.isAdmin) {
                        <button mat-raised-button color="primary" (click)="createEvent()">
                            <mat-icon>add_circle</mat-icon>
                            Plan Movie Night
                        </button>
                    }
                </div>

                @if (groupEvents.length > 0) {
                    <div class="events-list">
                        @for (eventItem of groupEvents; track eventItem.id) {
                            <div class="event-card" 
                                 (click)="viewEvent(eventItem)"
                                 (keydown.enter)="viewEvent(eventItem)"
                                 (keydown.space)="viewEvent(eventItem)"
                                 tabindex="0"
                                 role="button">
                                <div class="event-status" [class]="'status-' + eventItem.status">
                                    {{ getEventStatusLabel(eventItem.status) }}
                                </div>
                                
                                <div class="event-main">
                                    <div class="event-info">
                                        <h3 class="event-name">{{ eventItem.name }}</h3>
                                        @if (eventItem.eventDate) {
                                            <p class="event-date">
                                                <mat-icon>calendar_today</mat-icon>
                                                {{ eventItem.eventDate | date:'EEE, MMM d, y' }}
                                                @if (eventItem.startTime) {
                                                    <span class="event-time">at {{ eventItem.startTime }}</span>
                                                }
                                            </p>
                                        } @else {
                                            <p class="event-date">
                                                <mat-icon>event</mat-icon>
                                                Date to be determined
                                            </p>
                                        }
                                    </div>

                                    <button mat-icon-button (click)="viewEvent(eventItem); $event.stopPropagation()">
                                        <mat-icon>arrow_forward</mat-icon>
                                    </button>
                                </div>
                            </div>
                        }
                    </div>
                } @else {
                    <div class="empty-events">
                        <mat-icon>event_available</mat-icon>
                        <p>No movie nights planned yet</p>
                        @if (!groupData.isAdmin) {
                            <p class="hint-text">Ask an admin to schedule one!</p>
                        }
                    </div>
                    @if (groupData.isAdmin) {
                        <div class="section-header" style="justify-content: center; margin-top: 1rem;">
                            <button mat-raised-button color="primary" (click)="createEvent()">
                                <mat-icon>add_circle</mat-icon>
                                Plan Movie Night
                            </button>
                        </div>
                    }
                }
            </div>
        }
    </mat-card>
</main>